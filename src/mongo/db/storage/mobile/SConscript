Import("env")
Import("mobile_se")
env = env.Clone()


env.InjectThirdParty(libraries=['sqlite'])

env.Library(
    target='storage_mobile_core',
    source=[
        'mobile_index.cpp',
        'mobile_kv_engine.cpp',
        'mobile_record_store.cpp',
        'mobile_recovery_unit.cpp',
        'mobile_session.cpp',
        'mobile_session_pool.cpp',
        'mobile_sqlite_statement.cpp',
        'mobile_util.cpp',
        'mobile_options.cpp',
        env.Idlc('mobile_options.idl')[0],
        ],
    LIBDEPS=[
        '$VARIANT_DIR/mongo/base',
        '$VARIANT_DIR/mongo/db/catalog/collection_options',
        '$VARIANT_DIR/mongo/db/concurrency/lock_manager',
        '$VARIANT_DIR/mongo/db/concurrency/write_conflict_exception',
        '$VARIANT_DIR/mongo/db/index/index_descriptor',
        '$VARIANT_DIR/mongo/db/namespace_string',
        '$VARIANT_DIR/mongo/db/repl/repl_coordinator_interface',
        '$VARIANT_DIR/mongo/db/storage/index_entry_comparison',
        '$VARIANT_DIR/mongo/db/storage/journal_listener',
        '$VARIANT_DIR/mongo/db/storage/key_string',
        '$VARIANT_DIR/mongo/db/storage/recovery_unit_base',
        '$VARIANT_DIR/mongo/db/storage/kv/kv_prefix',
        '$VARIANT_DIR/mongo/db/storage/oplog_hack',
        '$VARIANT_DIR/third_party/shim_sqlite',
        ],
    LIBDEPS_PRIVATE= [
        '$VARIANT_DIR/mongo/util/options_parser/options_parser',
        ],
    )

serveronlyProgDepsDependents = []
if mobile_se:
    serveronlyProgDepsDependents = [
        '$VARIANT_DIR/mongo/mongod',
        '$VARIANT_DIR/mongo/dbtests/dbtest',
        ]
        
    env.Library(
        target='mobile_options_mongod',
        source=[
            'mobile_options_mongod.cpp',
        ],
        PROGDEPS_DEPENDENTS=serveronlyProgDepsDependents,
        LIBDEPS=[
            '$VARIANT_DIR/mongo/util/options_parser/options_parser',
        ],
        LIBDEPS_PRIVATE=[
            'storage_mobile_core',
        ],
    )

env.Library(
    target='storage_mobile',
    source=[
        'mobile_init.cpp',
        ],
    PROGDEPS_DEPENDENTS=serveronlyProgDepsDependents,
    LIBDEPS=[
        'storage_mobile_core',
        '$VARIANT_DIR/mongo/db/storage/durable_catalog_impl',
        '$VARIANT_DIR/mongo/db/storage/storage_engine_impl',
        ],
    LIBDEPS_PRIVATE=[
        '$VARIANT_DIR/mongo/db/storage/storage_engine_common',
    ],
)
'''
env.CppUnitTest(
    target='storage_mobile_index_test',
    source=[
        'mobile_index_test.cpp'
    ],
    LIBDEPS=[
        'storage_mobile_core',
        '$VARIANT_DIR/mongo/db/storage/sorted_data_interface_test_harness'
        ]
    )
'''

env.CppUnitTest(
    target='storage_mobile_record_store_test',
    source=[
        'mobile_record_store_test.cpp'
    ],
    LIBDEPS=[
        'storage_mobile_core',
        '$VARIANT_DIR/mongo/db/storage/record_store_test_harness',
        '$VARIANT_DIR/mongo/db/concurrency/write_conflict_exception',
        '$VARIANT_DIR/mongo/util/options_parser/options_parser',
    ]
)

env.CppUnitTest(
    target='storage_mobile_kv_engine_test',
    source=[
        'mobile_kv_engine_test.cpp',
    ],
    LIBDEPS=[
        '$VARIANT_DIR/mongo/db/storage/kv/kv_engine_test_harness',
        '$VARIANT_DIR/mongo/db/storage/storage_options',
        'storage_mobile_core',
    ],
    LIBDEPS_PRIVATE=[
        '$VARIANT_DIR/mongo/db/auth/authmocks',
    ],
)
