# -*- mode: python; -*-

Import("env")

env = env.Clone()

env.SConscript(
    dirs=[
        'util',
    ],
    exports=[
        'env',
    ],
)

env.Library(
    target='collection_options',
    source=[
        'collection_options.cpp',
    ],
    LIBDEPS=[
        '$VARIANT_DIR/mongo/base',
        '$VARIANT_DIR/mongo/db/command_generic_argument',
        '$VARIANT_DIR/mongo/db/query/collation/collator_interface',
    ],
)

env.Library(
    target = 'catalog_test_fixture',
    source =[
        'catalog_test_fixture.cpp',
    ],
    LIBDEPS=[
        'catalog_helpers',
        '$VARIANT_DIR/mongo/db/auth/authmocks',
        '$VARIANT_DIR/mongo/db/namespace_string',
        '$VARIANT_DIR/mongo/db/repl/repl_coordinator_interface',
        '$VARIANT_DIR/mongo/db/repl/replmocks',
        '$VARIANT_DIR/mongo/db/repl/storage_interface_impl',
        '$VARIANT_DIR/mongo/db/service_context_d_test_fixture',
    ],
)

env.Library(
    target='document_validation',
    source=[
        "document_validation.cpp",
    ],
    LIBDEPS=[
        "$VARIANT_DIR/mongo/db/service_context",
    ],
)

env.Library(
    target='commit_quorum_options',
    source=[
        'commit_quorum_options.cpp',
    ],
    LIBDEPS_PRIVATE=[
        '$VARIANT_DIR/mongo/bson/util/bson_extract',
    ],
)

env.Library(
    target='commit_quorum_idl',
    source=[
        env.Idlc('commit_quorum.idl')[0],
    ],
    LIBDEPS=[
        'commit_quorum_options',
        '$VARIANT_DIR/mongo/base',
        '$VARIANT_DIR/mongo/idl/idl_parser',
    ],
)

env.Library(
    target='index_build_entry_idl',
    source=[
        env.Idlc('index_build_entry.idl')[0],
    ],
    LIBDEPS=[
        'commit_quorum_idl',
        '$VARIANT_DIR/mongo/util/net/network',
    ],
)

env.Library(
    target='health_log',
    source=[
        "health_log.cpp",
        env.Idlc("health_log.idl")[0],
    ],
    LIBDEPS=[
        "$VARIANT_DIR/mongo/base",
        "$VARIANT_DIR/mongo/db/concurrency/deferred_writer",
        "$VARIANT_DIR/mongo/db/service_context",
        "$VARIANT_DIR/mongo/idl/idl_parser",
    ],
);

env.Library(
    target='index_builds_manager',
    source=[
        'index_builds_manager.cpp',
    ],
    LIBDEPS=[
        'multi_index_block',
        '$VARIANT_DIR/mongo/base',
    ],
    LIBDEPS_PRIVATE=[
        '$VARIANT_DIR/mongo/db/concurrency/write_conflict_exception',
        '$VARIANT_DIR/mongo/db/query/query_knobs',
    ]
)

env.Library(
        target='disable_index_spec_namespace_generation',
        source=[
            env.Idlc('disable_index_spec_namespace_generation.idl')[0],
        ],
        LIBDEPS_PRIVATE=[
            '$VARIANT_DIR/mongo/idl/server_parameter',
        ],
)

env.Library(
    target='index_key_validate',
    source=[
        "index_key_validate.cpp",
    ],
    LIBDEPS=[
        '$VARIANT_DIR/mongo/base',
        '$VARIANT_DIR/mongo/db/common',
        '$VARIANT_DIR/mongo/db/index/index_descriptor',
        '$VARIANT_DIR/mongo/db/index/key_generator',
        '$VARIANT_DIR/mongo/db/index_names',
        '$VARIANT_DIR/mongo/db/matcher/expressions',
        '$VARIANT_DIR/mongo/db/query/collation/collator_factory_interface',
        '$VARIANT_DIR/mongo/util/fail_point',
    ],
    LIBDEPS_PRIVATE=[
        'disable_index_spec_namespace_generation',
    ],
)

env.Library(
    target='index_catalog',
    source=[
        "index_catalog.cpp",
    ],
    LIBDEPS=[
        '$VARIANT_DIR/mongo/base',
        'index_catalog_entry',
    ],
)

env.Library(
    target='index_catalog_entry',
    source=[
        "index_catalog_entry.cpp",
    ],
    LIBDEPS=[
        '$VARIANT_DIR/mongo/base',
    ],
)

env.Library(
    target='index_timestamp_helper',
    source=[
        "index_timestamp_helper.cpp",
    ],
    LIBDEPS=[
        '$VARIANT_DIR/mongo/base',
    ],
    LIBDEPS_PRIVATE=[
        '$VARIANT_DIR/mongo/db/concurrency/write_conflict_exception',
        '$VARIANT_DIR/mongo/db/logical_clock',
        '$VARIANT_DIR/mongo/db/repl/repl_coordinator_interface',
        '$VARIANT_DIR/mongo/db/server_options_core',
    ]
)

env.Library(
    target='index_build_block',
    source=[
        "index_build_block.cpp",
    ],
    LIBDEPS=[
        '$VARIANT_DIR/mongo/base',
        '$VARIANT_DIR/mongo/db/index/index_descriptor',
        '$VARIANT_DIR/mongo/db/index_names',
    ],
    LIBDEPS_PRIVATE=[
        '$VARIANT_DIR/mongo/db/index/index_build_interceptor',
        '$VARIANT_DIR/mongo/db/logical_clock',
        '$VARIANT_DIR/mongo/db/repl/repl_coordinator_interface',
    ]
)

env.Library(
    target='collection',
    source=[
        "collection.cpp",
    ],
    LIBDEPS=[
        '$VARIANT_DIR/mongo/base',
    ],
)

env.Library(
    target='database_holder',
    source=[
        'database_holder.cpp',
    ],
    LIBDEPS=[
        'collection',
        '$VARIANT_DIR/mongo/base',
        '$VARIANT_DIR/mongo/db/service_context',
    ],
)

env.Library(
    target='multi_index_block',
    source=[
        'multi_index_block.cpp',
        env.Idlc('multi_index_block.idl')[0],
    ],
    LIBDEPS=[
        'collection',
        'index_timestamp_helper',
        '$VARIANT_DIR/mongo/base',
        '$VARIANT_DIR/mongo/db/audit',
        '$VARIANT_DIR/mongo/db/background',
        '$VARIANT_DIR/mongo/db/concurrency/write_conflict_exception',
        '$VARIANT_DIR/mongo/db/curop',
        '$VARIANT_DIR/mongo/db/repl/repl_coordinator_interface',
        '$VARIANT_DIR/mongo/db/service_context',
        '$VARIANT_DIR/mongo/db/storage/write_unit_of_work',
        '$VARIANT_DIR/mongo/util/fail_point',
        '$VARIANT_DIR/mongo/util/progress_meter',
    ],
    LIBDEPS_PRIVATE=[
        'index_build_block',
        '$VARIANT_DIR/mongo/db/index/index_build_interceptor',
        '$VARIANT_DIR/mongo/db/storage/storage_options',
        '$VARIANT_DIR/mongo/idl/server_parameter',
    ]
)

env.Library(
    target='collection_catalog',
    source=[
        'collection_catalog.cpp',
    ],
    LIBDEPS=[
        'collection',
        '$VARIANT_DIR/mongo/base',
        '$VARIANT_DIR/mongo/db/namespace_string',
        '$VARIANT_DIR/mongo/db/service_context',
    ],
    LIBDEPS_PRIVATE=[
        '$VARIANT_DIR/mongo/idl/server_parameter',
    ]
)

env.Library(
    target='collection_catalog_helper',
    source=[
        'collection_catalog_helper.cpp',
    ],
    LIBDEPS_PRIVATE=[
        'collection_catalog',
        '$VARIANT_DIR/mongo/db/concurrency/lock_manager',
    ]
)

env.Library(
    target='catalog_control',
    source=[
        "catalog_control.cpp",
    ],
    LIBDEPS_PRIVATE=[
        'collection',
        'collection_catalog',
        'database_holder',
        '$VARIANT_DIR/mongo/db/index_builds_coordinator_interface',
        '$VARIANT_DIR/mongo/db/repair_database',
        '$VARIANT_DIR/mongo/db/service_context',
    ],
)

env.Library(
    target='catalog_impl',
    source=[
        "collection_impl.cpp",
        "collection_info_cache_impl.cpp",
        "database_holder_impl.cpp",
        "database_impl.cpp",
        "index_catalog_entry_impl.cpp",
        "index_catalog_impl.cpp",
        "index_consistency.cpp",
        "private/record_store_validate_adaptor.cpp",
    ],
    LIBDEPS=[
        'collection',
        'collection_options',
        'database_holder',
        'health_log',
        'index_catalog',
        'index_catalog_entry',
        'index_key_validate',
        '$VARIANT_DIR/mongo/base',
        '$VARIANT_DIR/mongo/db/background',
        '$VARIANT_DIR/mongo/db/collection_index_usage_tracker',
        '$VARIANT_DIR/mongo/db/concurrency/lock_manager',
        '$VARIANT_DIR/mongo/db/curop',
        '$VARIANT_DIR/mongo/db/db_raii',
        '$VARIANT_DIR/mongo/db/index/index_access_method',
        '$VARIANT_DIR/mongo/db/index/index_access_method_factory',
        '$VARIANT_DIR/mongo/db/index_d',
        '$VARIANT_DIR/mongo/db/op_observer',
        '$VARIANT_DIR/mongo/db/repl/drop_pending_collection_reaper',
        '$VARIANT_DIR/mongo/db/repl/oplog',
        '$VARIANT_DIR/mongo/db/server_options_core',
        '$VARIANT_DIR/mongo/db/service_context',
        '$VARIANT_DIR/mongo/db/storage/key_string',
        '$VARIANT_DIR/mongo/db/storage/durable_catalog_impl',
        '$VARIANT_DIR/mongo/db/storage/storage_engine_impl',
        '$VARIANT_DIR/mongo/db/system_index',
        '$VARIANT_DIR/mongo/db/ttl_collection_cache',
        '$VARIANT_DIR/mongo/db/views/views_mongod',
    ],
    LIBDEPS_PRIVATE=[
        'index_build_block',
        'disable_index_spec_namespace_generation',
        '$VARIANT_DIR/mongo/db/catalog/collection_catalog_helper',
        '$VARIANT_DIR/mongo/db/commands/server_status_core',
        '$VARIANT_DIR/mongo/db/index/index_build_interceptor',
        '$VARIANT_DIR/mongo/db/logical_clock',
        '$VARIANT_DIR/mongo/db/repl/repl_settings',
        '$VARIANT_DIR/mongo/db/storage/storage_engine_common',
        '$VARIANT_DIR/mongo/db/transaction',
    ],
)

env.Library(
    target='catalog_helpers',
    source=[
        'capped_utils.cpp',
        'coll_mod.cpp',
        "collection_compact.cpp",
        'create_collection.cpp',
        'drop_collection.cpp',
        'drop_database.cpp',
        'drop_indexes.cpp',
        'rename_collection.cpp',
    ],
    LIBDEPS=[
        '$VARIANT_DIR/mongo/base',
        '$VARIANT_DIR/mongo/db/background',
        '$VARIANT_DIR/mongo/db/db_raii',
        '$VARIANT_DIR/mongo/db/index_builds_coordinator_interface',
        '$VARIANT_DIR/mongo/db/query_exec',
        '$VARIANT_DIR/mongo/db/server_options_core',
        '$VARIANT_DIR/mongo/db/views/views',
        '$VARIANT_DIR/mongo/db/write_ops',
        'collection_options',
        'collection',
        'index_catalog',
        'index_key_validate',
        'multi_index_block',
    ],
    LIBDEPS_PRIVATE=[
        'database_holder',
    ],
)

env.CppUnitTest(
    target='db_catalog_test',
    source=[
        'capped_utils_test.cpp',
        'catalog_control_test.cpp',
        'collection_catalog_test.cpp',
        'collection_options_test.cpp',
        'collection_test.cpp',
        'commit_quorum_options_test.cpp',
        'create_collection_test.cpp',
        'database_test.cpp',
        'drop_database_test.cpp',
        'index_build_entry_test.cpp',
        'index_builds_manager_test.cpp',
        'index_key_validate_test.cpp',
        'index_spec_validate_test.cpp',
        'multi_index_block_test.cpp',
        'rename_collection_test.cpp',
    ],
    LIBDEPS=[
        '$VARIANT_DIR/mongo/db/auth/authmocks',
        '$VARIANT_DIR/mongo/db/commands/test_commands_enabled',
        '$VARIANT_DIR/mongo/db/concurrency/lock_manager',
        '$VARIANT_DIR/mongo/db/db_raii',
        '$VARIANT_DIR/mongo/db/index_builds_coordinator_mongod',
        '$VARIANT_DIR/mongo/db/matcher/expressions',
        '$VARIANT_DIR/mongo/db/namespace_string',
        '$VARIANT_DIR/mongo/db/op_observer',
        '$VARIANT_DIR/mongo/db/query/query_test_service_context',
        '$VARIANT_DIR/mongo/db/repl/drop_pending_collection_reaper',
        '$VARIANT_DIR/mongo/db/repl/oplog',
        '$VARIANT_DIR/mongo/db/repl/optime',
        '$VARIANT_DIR/mongo/db/repl/repl_coordinator_interface',
        '$VARIANT_DIR/mongo/db/repl/replmocks',
        '$VARIANT_DIR/mongo/db/repl/storage_interface_impl',
        '$VARIANT_DIR/mongo/db/s/op_observer_sharding_impl',
        '$VARIANT_DIR/mongo/db/service_context',
        '$VARIANT_DIR/mongo/db/service_context_d_test_fixture',
        '$VARIANT_DIR/mongo/db/service_context_test_fixture',
        '$VARIANT_DIR/mongo/db/storage/kv/kv_prefix',
        '$VARIANT_DIR/mongo/unittest/unittest',
        'catalog_control',
        'catalog_helpers',
        'catalog_test_fixture',
        'collection',
        'collection_catalog',
        'collection_catalog_helper',
        'collection_options',
        'commit_quorum_options',
        'database_holder',
        'index_build_block',
        'index_build_entry_idl',
        'index_builds_manager',
        'index_key_validate',
        'multi_index_block',
    ],
)
